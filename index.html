<!DOCTYPE html>
<html>
<head>
  <title>Speaker Page</title>
  <!-- Include Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
  <h1>Speaker Page</h1>
  <button id="callButton">Call Receiver</button>
  <audio id="remoteAudio" autoplay></audio>

  <script>
    // Initialize Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyC1QgZw1hNhesqrq7gU-B4-IAKScY9ACdE",
    authDomain: "echo-b2f1f.firebaseapp.com",
    projectId: "echo-b2f1f",
    storageBucket: "echo-b2f1f.appspot.com",
    messagingSenderId: "795689625860",
    appId: "1:795689625860:web:9bcf69b393cc66ebdd4851",
    measurementId: "G-KZ2YBEV61X"
    };
    firebase.initializeApp(firebaseConfig);

    // Get a reference to the Firebase Realtime Database
    var database = firebase.database();
    var signalingRef = database.ref('calls').push();

    // Create local RTCPeerConnection
    var localConnection = new RTCPeerConnection();

    // Get local media stream
    navigator.mediaDevices.getUserMedia({ audio: true })
      .then(function(stream) {
        // Add local stream to connection
        stream.getTracks().forEach(function(track) {
          localConnection.addTrack(track, stream);
        });
      })
      .catch(function(error) {
        console.error('Error accessing media devices:', error);
      });

    // Handle call button click event
    var callButton = document.getElementById('callButton');
    callButton.addEventListener('click', function() {
      // Generate a unique call ID
      var callId = signalingRef.key;

      // Listen for changes in signaling data
      signalingRef.child('signalingData').on('value', function(snapshot) {
        var signalingData = snapshot.val();

        if (signalingData && signalingData.type === 'answer') {
          // Create remote RTCSessionDescription using the received answer
          var remoteDescription = new RTCSessionDescription(signalingData);

          // Set remote description on the local peer connection
          localConnection.setRemoteDescription(remoteDescription);
        }
      });

      // Create offer
      localConnection.createOffer()
        .then(function(offer) {
          // Set local description
          return localConnection.setLocalDescription(offer);
        })
        .then(function() {
          // Update signaling data in Firebase Realtime Database
          return signalingRef.update({
            signalingData: {
              type: localConnection.localDescription.type,
              sdp: localConnection.localDescription.sdp
            }
          });
        })
        .catch(function(error) {
          console.error('Error creating or setting local description:', error);
        });
    });
  </script>
</body>
</html>
